<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.10.1/main.min.css' rel='stylesheet' />
    <link rel="stylesheet" href="/css/styles.css">
    <!-- TUI Calendar CSS -->
    <link rel="stylesheet" href="https://uicdn.toast.com/tui-calendar/latest/tui-calendar.min.css" />
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.css" />
    <link rel="stylesheet" href="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.css" />
    <title>Dashboard</title>
</head>
<body class="dashboard-bg">
    <div class="d-flex">
        <nav class="sidebar" id="sidebar">
            <div class="logo-container text-center" style="padding: 2.5rem 0 2rem 0;">
                <img src="/images/logo.png" alt="Logo" class="logo" style="display: block; margin: 0 auto; width: 90px;">
            </div>
            <ul class="list-unstyled">
                <li><a href="/dashboard" class="nav-link item"><i class="fas fa-home"></i> INICIO</a></li>
                <li>
                    <a href="#oficios" class="nav-link" data-toggle="collapse" aria-expanded="false" aria-controls="oficios"><i class="fas fa-briefcase"></i> OFICIOS CREADOS</a>
                    <ul class="collapse" id="oficios">
                        <li><a href="/oficios/crear-nuevo" class="nav-link item"><i class="fas fa-plus"></i> Crear nuevo</a></li>
                        <li><a href="/oficios/mis-oficios-enviados" class="nav-link item"><i class="fas fa-paper-plane"></i> Mis oficios enviados</a></li>
                        <li><a href="/lista-general" class="nav-link item"><i class="fas fa-list"></i> Lista general</a></li>
                        <li><a href="/recepcion" class="nav-link item"><i class="fas fa-inbox"></i> En recepción</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#oficiosRecibidos" class="nav-link" data-toggle="collapse" aria-expanded="false" aria-controls="oficiosRecibidos"><i class="fas fa-inbox"></i> OFICIOS RECIBIDOS</a>
                    <ul class="collapse" id="oficiosRecibidos">
                        <li><a href="/oficios/crear-recibido" class="nav-link item"><i class="fas fa-plus"></i> Agregar</a></li>
                        <li><a href="/oficios/recibidos" class="nav-link item"><i class="fas fa-eye"></i> Ver todos</a></li>
                    </ul>
                </li>
                <li>
                    <a href="#actas" class="nav-link" data-toggle="collapse" aria-expanded="false" aria-controls="actas"><i class="fas fa-file-alt"></i> ACTAS</a>
                    <ul class="collapse" id="actas">
                        <li><a href="/crear-acta" class="nav-link item"><i class="fas fa-plus"></i> Crear una nueva</a></li>
                        <li><a href="/mis-actas-creadas" class="nav-link item"><i class="fas fa-file"></i> Mis actas creadas</a></li>
                        <li><a href="/reuniones-realizadas" class="nav-link item"><i class="fas fa-calendar-check"></i> Reuniones realizadas</a></li>
                        <li><a href="/agregar-participante" class="nav-link item"><i class="fas fa-user-plus"></i> Agregar Participante</a></li>
                    </ul>
                </li>
                <% if (user && user.rol === 'superusuario') { %>
                <li>
                    <a href="/usuarios" class="nav-link item text-uppercase"><i class="fas fa-users-cog"></i> GESTIÓN DE USUARIOS</a>
                </li>
                <% } %>
                <li><a href="/logout" class="nav-link item"><i class="fas fa-sign-out-alt"></i> SALIR</a></li>
            </ul>
        </nav>
        <div class="content superuser-dashboard w-100">
            <div class="text-center pt-4 pb-2">
                <h1 class="mb-4" style="font-family: 'Poppins', sans-serif; font-weight: 600; text-align: center;">Bienvenidos</h1>
            </div>
            <div class="row justify-content-center mb-4">
                <div class="col-md-6 mb-4">
                    <div class="card shadow-lg p-3" style="border: 1.5px solid #b0b4b9; background: #f8fafc; box-shadow: 0 6px 32px rgba(80,80,80,0.08);">
                        <h5 class="text-center mb-3" style="font-family: 'Poppins', sans-serif; font-weight: 700; letter-spacing: 1px; color: #3a3d42; text-transform: uppercase;">CALENDARIO</h5>
                        <div id="calendar" style="height: 600px;"></div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card shadow-lg p-3">
                        <h5 class="text-center mb-3">Oficios Enviados vs Recibidos</h5>
                        <canvas id="graficoOficios" width="300" height="300"></canvas>
                        <div class="text-center mt-2">
                            <span class="badge badge-primary">Enviados</span>
                            <span class="badge badge-dark">Recibidos</span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="ajax-content" class="d-flex justify-content-center align-items-center" style="min-height: 70vh;"></div>
        </div>
        <div class="user-circle" id="userCircle">
            <i class="fas fa-user-circle user-icon"></i>
            <div class="logout-menu" id="logoutMenu">
                <a href="/logout">Logout</a>
            </div>
        </div>
        <% if (user && user.rol) { %>
          <div class="user-role text-right p-2" style="position: absolute; top: 0; right: 0; z-index: 1000;">
            <span class="badge badge-info">
              <i class="fas fa-user-shield"></i>
              <%= user.rol === 'superusuario' ? 'Superusuario' : 'Usuario' %>
            </span>
          </div>
        <% } %>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- TUI Calendar JS y dependencias -->
    <script src="https://uicdn.toast.com/tui.code-snippet/latest/tui-code-snippet.js"></script>
    <script src="https://uicdn.toast.com/tui.dom/latest/tui-dom.js"></script>
    <script src="https://uicdn.toast.com/tui.time-picker/latest/tui-time-picker.js"></script>
    <script src="https://uicdn.toast.com/tui.date-picker/latest/tui-date-picker.js"></script>
    <script src="https://uicdn.toast.com/tui-calendar/latest/tui-calendar.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        var Calendar = tui.Calendar;
        var calendar = new Calendar('#calendar', {
          defaultView: 'month',
          taskView: false,
          scheduleView: true,
          useCreationPopup: true,
          useDetailPopup: true,
          calendars: [
            {
              id: '1',
              name: 'Eventos',
              color: '#ffffff',
              bgColor: '#007bff',
              dragBgColor: '#007bff',
              borderColor: '#007bff'
            }
          ]
        });
        // Ejemplo: agregar un evento
        calendar.createSchedules([
          {
            id: '1',
            calendarId: '1',
            title: 'Evento de ejemplo',
            category: 'time',
            start: '2025-07-17T10:00:00',
            end: '2025-07-17T12:00:00'
          }
        ]);
      });
    </script>
    <script>
        // Script para mostrar/ocultar el menú al pasar el cursor
        const sidebar = document.getElementById('sidebar');
        sidebar.addEventListener('mouseenter', () => {
            sidebar.classList.add('active');
        });
        sidebar.addEventListener('mouseleave', () => {
            sidebar.classList.remove('active');
        });

        const userCircle = document.getElementById('userCircle');
        const logoutMenu = document.getElementById('logoutMenu');

        userCircle.addEventListener('click', () => {
            logoutMenu.style.display = logoutMenu.style.display === 'block' ? 'none' : 'block'; // Alternar visibilidad
        });

        // Cerrar el menú si se hace clic fuera de él
        window.addEventListener('click', (event) => {
            if (!userCircle.contains(event.target) && !logoutMenu.contains(event.target)) {
                logoutMenu.style.display = 'none';
            }
        });
    </script>
    <script>
        $(document).ready(function() {
            $("a.nav-link:contains('Gestión de Usuarios')").on('click', function(e) {
                e.preventDefault();
                $.get('/dashboard/usuarios', function(data) {
                    $('#ajax-content').html(data);
                });
            });
            // Botón volver al dashboard
            $(document).on('click', '#volver-dashboard', function() {
                $('#ajax-content').empty();
            });

            // Gráfico circular de enviados/recibidos
            $.get('/oficios/estadisticas', function(data) {
                var ctx = document.getElementById('graficoOficios').getContext('2d');
                new Chart(ctx, {
                    type: 'doughnut',
                    data: {
                        labels: ['Enviados', 'Recibidos'],
                        datasets: [{
                            data: [data.enviados, data.recibidos],
                            backgroundColor: ['#007bff', '#343a40'],
                            borderWidth: 2
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            });
        });
        </script>
    <script>
// Solo un menú colapsado a la vez
$(document).ready(function() {
    $('.sidebar .nav-link[data-toggle="collapse"]').on('click', function(e) {
        var target = $(this).attr('href');
        $('.sidebar .collapse').not(target).collapse('hide');
    });
});
</script>
</body>
</html>
